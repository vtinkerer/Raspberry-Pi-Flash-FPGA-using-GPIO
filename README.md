# Raspberry-Pi-Flash-FPGA-using-GPIO

This project helps you to flash FPGA via GPIO of Raspberry Pi without usb-blaster (or any other device) using [urjtag](https://sourceforge.net/projects/urjtag/) tool using .svf files generated by Quartus software.
It's tested for Raspberry Pi 4B and Cyclone IV FPGA on the OMDAZZ development board.
The code is a modified version of the [urjtag](https://sourceforge.net/projects/urjtag/).

# Why

The first problem of Raspberry Pi flashing the FPGA is the fact that the Quartus is not supported for the ARM devices (like Raspberry Pi).
There's an open-source tool called [urjtag](https://sourceforge.net/projects/urjtag/), but unfortunately it works with an old sysfs GPIO interface which is now [deprecated](https://www.thegoodpenguin.co.uk/blog/stop-using-sys-class-gpio-its-deprecated/) and is no longer used. The new approach for working with the GPIO is the "character device". There's a [libgpiod](https://github.com/brgl/libgpiod/blob/master/README) library for this case.
So, in order to be able to flash the FGPA from Raspberry Pi, you can use this modified version of the [urjtag](https://sourceforge.net/projects/urjtag/) in which I rewrote the gpio module using the [libgpiod](https://github.com/brgl/libgpiod/blob/master/README) under the hood.

# Prerequisites

## Libgpiod installed

You need to have the [libgpiod](https://github.com/brgl/libgpiod/blob/master/README) installed on your Raspberry Pi. This project uses the version 2.1.2. You can verify the version by calling:

```
$ gpiodetect --version
```

Also, make sure that you have the library files located in /usr/include/gpiod.h and /lib/aarch64-linux-gnu/libgpiod.a or .so
If you don't, then visit the [libgpiod](https://github.com/brgl/libgpiod/blob/master/README)

# Installation

Simply run

```
./configure CFLAGS="-I/usr/include" LDFLAGS="-lgpiod‚Äù && make
```

If you face some errors, it can be probably caused by the libgpiod installation

And if everything's fine, then

```
sudo make install
```

Now you should see the executable file ./src/apps/jtag/jtag which is the modified urjtag you can use to flash the FPGA.

# Usage

1. Wire the GPIOs to the OMDAZZ board's JTAG conntectors.
2. Run the "jtag" executable file you got by completing the Installation section.
3. Run the "cable gpio" and follow the instructions on how to set up the proper Raspberry Pi GPIO numbers for JTAG pins on the board. In my case I did "cable gpio tdi=23 tdo=24 tck=25 tms=18"
4. Run "detect".
5. Now you can probably see the "Unknown part!" text. It means that urjtag doesn't support the board by default, but it's easy to fix. Download the [BSDL file](https://bsdl.info/download.htm?sid=4613df0d1112445b88ca59b002289d77) (this one is an example for OMDAZZ Cyclone IV, the one you need can differ) and use it by typing "include <PATH>". In my case it was "include /home/pi/EP4CE10E22.bsdl".
6. Now you're ready to flash the Cyclone IV! Use the "svf" command. In my case it was "svf /home/pi/lab_1.svf".

# What's changed

The only file changed is /src/tap/cable/gpio.c
